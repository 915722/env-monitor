# 基于 Cesium 的环境监测数据三维可视化系统 - GitHub Pages 部署指南

本文档详细介绍如何将本项目（Vue 3 + Vite + Cesium）部署到 GitHub Pages，实现免费的在线访问。

## 📋 目录

- [前置准备](#前置准备)
- [快速部署步骤](#快速部署步骤)
- [详细配置说明](#详细配置说明)
- [本地测试](#本地测试)
- [常见问题与解决方案](#常见问题与解决方案)
- [进阶配置](#进阶配置)

---

## 🔧 前置准备

### 必备条件

- [x] GitHub 账号
- [x] Git 已安装（或使用 GitHub Desktop）
- [x] Node.js 18+ 已安装
- [x] 项目代码已准备好

### 技术栈说明

本项目使用以下技术栈：
- **前端框架**：Vue 3 + TypeScript
- **构建工具**：Vite 5
- **三维引擎**：Cesium 1.113
- **可视化库**：ECharts 5.5
- **UI 组件库**：Element Plus

---

## 🚀 快速部署步骤

### 第一步：创建 GitHub 仓库

1. 登录 [GitHub](https://github.com)
2. 点击右上角 `+` → `New repository`
3. 填写仓库信息：
   - **Repository name**：建议使用 `env-monitor`（或其他英文名称）
   - **Description**：环境监测数据三维可视化系统
   - **Public**：必须选择公开仓库（GitHub Pages 免费版仅支持公开仓库）
4. 点击 `Create repository`

### 第二步：配置项目路径

⚠️ **重要**：修改 `vite.config.ts` 文件中的 `base` 路径，使其与仓库名称一致。

打开 `vite.config.ts`，找到第 8 行：

```typescript
base: command === 'build' ? '/env-monitor/' : '/',
```

将 `/env-monitor/` 改为 `/你的仓库名/`，例如：
- 如果仓库名是 `env-monitor-3d`，改为 `/env-monitor-3d/`
- 如果仓库名是 `cesium-visualization`，改为 `/cesium-visualization/`

> **提示**：路径必须以 `/` 开头和结尾，例如 `/my-repo/`

### 第三步：推送代码到 GitHub

在项目根目录打开终端，执行以下命令：

```bash
# 初始化 Git 仓库（如果尚未初始化）
git init

# 添加远程仓库地址（替换为你的仓库地址）
git remote add origin https://github.com/你的用户名/你的仓库名.git

# 添加所有文件
git add .

# 提交代码
git commit -m "Initial commit: 环境监测三维可视化系统"

# 推送到 main 分支
git push -u origin main
```

### 第四步：开启 GitHub Pages

1. 进入 GitHub 仓库页面
2. 点击顶部 **Settings** (⚙️ 设置)
3. 在左侧菜单找到 **Pages**
4. 在 **Build and deployment** 区域：
   - **Source**：选择 **GitHub Actions** ⚠️（不要选 Deploy from a branch）
5. 保存后，GitHub Actions 会自动接管部署

### 第五步：等待自动部署

1. 点击仓库顶部的 **Actions** 标签页
2. 查看 "Deploy to GitHub Pages" 工作流状态：
   - 🟡 黄色图标：正在构建中
   - ✅ 绿色对号：部署成功
   - ❌ 红色叉号：部署失败（查看日志排查问题）
3. 首次部署通常需要 2-5 分钟

### 第六步：访问网站

部署成功后，访问地址为：

```
https://你的用户名.github.io/你的仓库名/
```

例如：`https://zhangsan.github.io/env-monitor/`

你也可以在 **Settings** → **Pages** 页面看到访问链接。

---

## 📝 详细配置说明

### 自动化部署工作流

项目已包含 `.github/workflows/deploy.yml` 文件，配置说明：

```yaml
触发条件：
  - 推送到 main 分支
  - 手动触发（workflow_dispatch）

构建步骤：
  1. 检出代码
  2. 设置 Node.js 18 环境
  3. 安装依赖 (npm ci)
  4. 构建项目 (npm run build)
  5. 添加 .nojekyll 文件（防止 Jekyll 处理）
  6. 上传构建产物到 GitHub Pages

部署步骤：
  - 自动部署 dist 目录到 GitHub Pages
```

### 关键配置文件

#### 1. `vite.config.ts` - 构建路径配置

```typescript
base: command === 'build' ? '/仓库名/' : '/'
```

- **开发环境**：使用根路径 `/`
- **生产环境**：使用仓库路径 `/仓库名/`

#### 2. `.github/workflows/deploy.yml` - CI/CD 流程

- 自动触发构建
- 自动部署到 GitHub Pages
- 支持手动触发

#### 3. `package.json` - 构建脚本

```json
"scripts": {
  "dev": "vite",              // 本地开发
  "build": "vite build",      // 生产构建
  "preview": "vite preview"   // 预览构建结果
}
```

---

## 🧪 本地测试

在部署到 GitHub Pages 之前，建议先在本地测试生产构建：

### 1. 安装依赖

```bash
npm install
```

### 2. 本地开发预览

```bash
npm run dev
```

访问 `http://localhost:5173`

### 3. 生产环境构建

```bash
npm run build
```

构建产物会输出到 `dist` 目录。

### 4. 预览生产构建

```bash
npm run preview
```

⚠️ **注意**：由于 `base` 路径配置，本地预览可能与线上略有不同。可临时修改 `vite.config.ts` 中的 `base` 为 `/` 进行测试，但记得提交前改回正确路径。

---

## ❓ 常见问题与解决方案

### 问题 1：页面显示空白或 404

**原因**：`base` 路径配置不正确

**解决方案**：
1. 检查 `vite.config.ts` 中的 `base` 是否与仓库名一致
2. 确保路径格式为 `/仓库名/`（两端都有斜杠）
3. 重新构建并推送：
   ```bash
   npm run build
   git add .
   git commit -m "fix: 修复 base 路径配置"
   git push
   ```

### 问题 2：静态资源（图片、CSS）加载失败

**原因**：资源路径错误

**解决方案**：
1. 检查浏览器控制台的报错信息
2. 确认 `public` 目录下的文件路径
3. 确保 Cesium 静态资源正确引用：
   ```typescript
   // Cesium 静态资源应放在 public/cesium 目录
   window.CESIUM_BASE_URL = '/cesium/'
   ```

### 问题 3：更新代码后网站没有变化

**原因**：浏览器缓存或构建延迟

**解决方案**：
1. 等待 2-3 分钟让 GitHub Pages 完成部署
2. 强制刷新浏览器：
   - Windows: `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`
3. 清除浏览器缓存
4. 尝试隐私/无痕模式访问

### 问题 4：GitHub Actions 构建失败

**原因**：依赖安装失败或构建错误

**解决方案**：
1. 点击 Actions 标签页，查看失败的工作流
2. 点击失败的任务，查看详细日志
3. 常见错误：
   - **依赖安装失败**：检查 `package.json` 中的依赖版本
   - **TypeScript 错误**：本地运行 `npm run build:check` 检查类型错误
   - **内存不足**：可能是 Cesium 打包过大，已在 `vite.config.ts` 中配置 `chunkSizeWarningLimit: 5000`

### 问题 5：Cesium 地形/影像无法加载

**原因**：Cesium 静态资源配置问题

**解决方案**：
1. 确保 `public/cesium` 目录包含完整的 Cesium 资源
2. 检查 `main.ts` 中的 Cesium 基础路径配置：
   ```typescript
   window.CESIUM_BASE_URL = '/cesium/'
   ```
3. 如果使用在线 Token，检查 Cesium Ion Token 是否有效

### 问题 6：GitHub Pages 没有"GitHub Actions"选项

**原因**：可能是仓库设置问题

**解决方案**：
1. 确保仓库是公开的（Private 仓库需要 Pro 账号）
2. 检查仓库权限设置：Settings → Actions → General
3. 确保 Workflow permissions 设置为 "Read and write permissions"

---

## 🔥 进阶配置

### 自定义域名

如果你有自己的域名，可以配置自定义域名：

1. 在 `public` 目录下创建 `CNAME` 文件
2. 文件内容填写你的域名，例如：`monitor.example.com`
3. 在域名提供商处添加 DNS 记录：
   ```
   类型: CNAME
   名称: monitor
   值: 你的用户名.github.io
   ```

### 环境变量配置

如果需要配置 API 密钥等环境变量：

1. 在仓库 Settings → Secrets and variables → Actions 中添加 Secrets
2. 在 `.github/workflows/deploy.yml` 中引用：
   ```yaml
   - name: 构建项目
     env:
       VITE_CESIUM_TOKEN: ${{ secrets.CESIUM_TOKEN }}
     run: npm run build
   ```
3. 在代码中使用：`import.meta.env.VITE_CESIUM_TOKEN`

### 性能优化建议

1. **启用 Gzip 压缩**：GitHub Pages 自动支持
2. **CDN 加速**：可配合 Cloudflare 等 CDN 服务
3. **图片优化**：压缩 PNG/JPG 图片，使用 WebP 格式
4. **代码分割**：已在 `vite.config.ts` 中配置 ECharts 分包

### 多分支部署

如果需要同时维护多个版本（如开发版和正式版）：

1. 创建 `gh-pages` 分支用于部署
2. 修改 `deploy.yml` 触发分支
3. 在 Settings → Pages 中选择 `gh-pages` 分支

---

## 📞 技术支持

如果在部署过程中遇到问题：

1. 检查 [GitHub Pages 官方文档](https://docs.github.com/pages)
2. 查看 [Vite 部署指南](https://vitejs.dev/guide/static-deploy.html)
3. 查看 [Cesium 官方文档](https://cesium.com/docs/)
4. 在项目 Issues 中提问

---

## 📄 许可证

本项目遵循相关开源协议，请参考项目根目录下的 LICENSE 文件。

---

**最后更新时间**：2026-01-29

**适用版本**：Vue 3.4 + Vite 5.0 + Cesium 1.113
